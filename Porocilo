\documentclass[a4paper,12pt]{article}

\usepackage[slovene]{babel}
\usepackage{amsfonts,amssymb,amsmath}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{graphicx}



\def\N{\mathbb{N}} % mnozica naravnih stevil
\def\Z{\mathbb{Z}} % mnozica celih stevil
\def\Q{\mathbb{Q}} % mnozica racionalnih stevil
\def\R{\mathbb{R}} % mnozica realnih stevil
\def\C{\mathbb{C}} % mnozica kompleksnih stevil
\newcommand{\geslo}[2]{\noindent\textbf{#1} \quad \hangindent=1cm #2\\[-1pc]}


\def\qed{$\hfill\Box$}   % konec dokaza
\def\qedm{\qquad\Box}   % konec dokaza v matematičnem načinu
\newtheorem{izrek}{Izrek}
\newtheorem{trditev}{Trditev}
\newtheorem{posledica}{Posledica}
\newtheorem{lema}{Lema}
\newtheorem{opomba}{Opomba}
\newtheorem{definicija}{Definicija}
\newtheorem{zgled}{Zgled}

\title{Poročilo o projektu: \\
$C^2$ kubični Bezierjev zlepek}
\author{Timotej Stibilj \\
Fakulteta za matematiko in fiziko \\
Oddelek za matematiko}
\date{8.\ julij 2023}

\begin{document}

\maketitle

\section{Cilj}

Naj bodo danih N interpolacijskih točk, delilne točke in tangentna vektorja v prvi in zadnji od teh točk. Konstruiramo C2 kubični Bezierjev
zlepek, ki interpolira dane podatke. Obravnavamo tudi Besselov zlepek, ko tangentni v krajiščih nista podani. Na zgledu prikažemo vpliv izbire različnih $\alpha$-parametrizacij na obliko interpolanta.

\section{Ozadje problema}
Predstavimo matematično ozadje problema. Večino lastnosti je zgolj navedenih, dokaze lahko najdemo denimo v $\cite{CAGD}$.\\

\subsection{Bezierjeve krivulje}
Bezierjeve krivulje so polinomske parametrične krivulje, s katerimi lahko hitro in učinkovito modeliramo in so zato koristne pri računalniškem oblikovanju. Bezierjeva krivulja $b^n: [0, 1] \to R^n$ je natanko določena z danimi kontrolnimi točkami $b_j, j = 0, 1, \ldots, n$ in jo dobimo s pomočjo deCasteljaujevega algoritma:

\text{Definiramo: } $b_j^{(0)} = b_j$, $j = 0, 1, \ldots, n.$

\text{Ponavljamo:}
\[
b_j^{(k)}(t) = (1 - t)\cdot b_{j}^{(k-1)}(t) + t \cdot b_{j+1}^{(k-1)}(t), \\ k = 1, 2, \ldots, n, j = 0, 1, \ldots, n - k.
\]

\text{Izhod: } $b^n(t) = b_0^{(n)}(t) \text{ je točka pri parametru} t \text{na Bézierovi krivulji } b^n$.
\vspace{7px}
\\Od zdaj naprej bomo zaradi preglednosti in možnosti grafičnega prikaza gledali Bezierjeve krivulje v ravnini, tj. $b_n: [0, 1] \to R^2$. Vse lastnosti Bezierjevih krivulj in postopki pri reševanju zastavljenega problema se lahko brez novih premislekov posplošijo na Bezierjeve krivulje v $R^n$.

Decastaljauov algoritem je primeren za računalniško implementacijo, za izpeljavo matematičnih lastnosti pa je primernejši ekvivalentni zapis z Bernsteinovimi polinomi. Bezierjevo krivuljo $b^n: [0, 1] \to R^n$ na danih kontrolnih točkah $b_j$, $j = 0, 1, \ldots, n$ zapišemo kot: \[
b^n(t) = \sum_{j=0}^n B_j^n(t) \cdot b_j \text{.}
\]
Pri tem je $B_j^n(t) = \binom{n}{j}t^j\cdot(1-t)^{n-j}$ j-ti Bernsteinov polinom n-te stopnje.

S pomočjo zapisa z Bernsteinovimi polinomi lahko izpeljemo formulo za odvod Bezierjeve krivulje %b^n$:
\[ \frac{d^r}{dt^r} = n(n - 1) \cdot \cdot \cdot (n - r + 1) \sum_{j=0}^{n-r} \Delta^r b_j B_{j}^{n-r}(t), \quad r = 1, 2, \ldots, n .\] 
Pri tem je $$\Delta b_j := b_{j+1} - b_j \quad \text{in} \quad \Delta^r b_j = \Delta (\Delta^{r-1} b_j)\text{.}$
V nadaljevanju bo koristno poznati posebne primere:
\begin{itemize}
    \label{odvodi}
    \item $\frac{db^n}{dt}(0)=n\cdot(b_1-b_0)$,
    \item $\frac{db^n}{dt}(1) = n\cdot(b_n-b_{n-1})$,
    \item $\frac{d^2b^n}{dt^2}(0)=n(n-1)(b_2-2b_1+b_0)$,
    \item $\frac{d^2b^n}{dt^2}(1) = n(n-1)(b_n-2b_{n-1}+b_{n-2})$,
\end{itemize}




\subsection{Zlepki Bezierjevih krivulj}
Pri modeliranju krivulj kompleksnih oblik bi potrebovali Bezierjeve krivulje visokih stopenj, kar predstavlja večjo nestabilnost. Pri tem Bezierjeva krivulja interpolira zgolj robni točki. Obeh problemov se lotimo z zlepki Bezierjevih krivulj.\\
Recimo, da imamo danih $N+1$ interpolacijskih točk. Ideja je v tem, da skozi vsaki dve zaporedni interpolacijski napeljemo Bezierjevo krivuljo.
Natančneje:
\begin{definicija}
    \label{deff}
    Naj bo dano naraščajoče zaporedje $N+1$ delilnih točk:
    \[
    u_0 < u_1< \ldots < u_{N}\text{.}
    \]
    Parametrična polinomska krivulja $s:[u_0, u_N] \to R^2$ je interpolacijski Bezierjev zlepek stopnje n, če velja:
    \begin{itemize}
        \item Odsek zlepka $s_j := s|_{[u_j, u_{j+1}]}$, $j = 0, 1, \ldots, N-1$, je Bezierova krivulja stopnje $n$.
        \item $s_j(u_{j+1}) = s_{j+1}(u_{j+1})$ za vsak $j = 0, 1, \ldots, N-1$.
    \end{itemize}
\end{definicija}
Možnih variant Bezierjevih zlepkov je veliko. Najmanj kar zahtevamo že v definiciji je, da interpolira dane interpolacijske točke. Če zahtevamo zgolj to, je zelo verjetno, da se posamezni odseki v interpolacijskih točkah oz. stičnih točkah ne zlepijo lepo. Natančneje, skrbi nas odvedljivost krivulje $s$ v delilnih točkah (v notranjosti je seveda odvedljiva, celo gladka, saj je na tem odseku Bezierjeva krivulja). Naslednji korak je torej to, da zahtevamo zvezno odvedljivost - $C^1$ ali pa dvakrat zvezno odvedljivost - $C^2$ krivulje $s$. \\
Poleg tega še nismo določili kakšen naj bo $n$ tj. stopnja Bezierjevih krivulj $s_j$ na posameznih odsekih. Kvadratne in kubične Bezierjeve krivulje so najpogostejši kompromis med stabilnostjo in možnostjo modeliranja kompleksnih krivulj. Tu se bomo osredotočili na $C^2$ Bezierjev zlepek, kjer je vsaka Bezierjeva krivulja $s_j$ kubična, torej določena s 4 kontrolnimi točkami. 

\subsubsection{Globalni parameter}
Krivulja $s$ je parametrizirana s t.i. globalnim parametrom $u \in [u_0, u_N]$. Na odsekih $[u_j, u_{j+1}$ imamo definirane Bezierjeve krivulje $s_j$, ki jih po definiciji parametriziramo s parametrom $t \in [0, 1]$. Za njihovo obravnavo za vsako Bezierjevo krivuljo $s_i, \text{ }i=0, \ldots N-1$ definiramo lokalni parameter \[
t_i = \frac{u-u_i}{u_{i+1} - u_i} \in [0, 1]\text{.}\] Za krajši zapis označimo še $\Delta{u_i}=u_{i+1} - u_i$.
Ker gre za afino transformacijo parametra na katero so Bezierjeve krivulje invariantne, velja:\[
s|_{[u_j, u_{j+1}]}(u) = s_j(t_j)\text{.}
\]

Če želimo $C^2$ zlepek mora poleg zahtev iz definicije \ref{deff} veljati še: \\$\frac{d^2s}{du^2}(u_j-0)=\frac{d^2s}{du^2}(u_j+0)$ in $\frac{ds}{du}(u_j-0)=\frac{ds}{du}(u_j+0)$, kar simbolizira ujemanje levih in desnih prvih/drugih odvodov krivulje $s$ v stičnih oz. interpolacijskih točkah.

Uporabno je, da znamo izraziti odvod krivulje $s$ z lokalnim parametrom, saj o tem že nekaj vemo (glej \ref{odvodi}).
Po verižnem pravilu velja: \[\frac{{d}}{{du}}s(u) = \frac{{d}}{{dt_i}}s_i(t) \cdot \frac{{dt_i}}{{du}} = \frac{{1}}{{\Delta{u_i}}} \frac{{d}}{{dt_i}}s_i(t).\]

\section{Opis reševanja}
\subsubsection{Osnovni primer}
Naj bodo danih $N+1$ interpolacijskih točk $p_0, \ldots, p_N$, $N+1$ delilnih točk $u_0, \ldots, u_N$ in tangentna vektorja $v_0, v_N$ v prvi in zadnji od teh točk. Konstruiramo C2 kubični Bezierjev
zlepek $s$, ki interpolira dane interpolacijske točke. Na vsakem izmed intervalov $[u_j, u_{j+1}], j = 0, 1, \ldots N-1$ bomo imeli kubično Bezierjevo krivuljo $s_j$. Označimo tangetne vektorje na krivuljo $s$ v delilnih točkah z $v_i=s'(u_i), i=0, \ldots, N$. \\
Kakšen naj bo zapis posamezne Bezierjeve krivulje $s_j, j=0, \ldots, N-1$, da bomo dobili kubični $C^2$ interpolacijski Bezierjev zlepek?
Splošna kubična Bezierjeva krivulja bo določena s 4 kontrolnimi točkami in bo oblike:
\[
s_j(t_j) = \sum_{i=0}^3 B_i^n(t_j) \cdot b_{ji}\text{.} 
\]
Pri tem je $t_j$ lokalni parameter, $b_{ji}$ pa i-ta kontrolna točka na j-ti Bezierjevi krivulji.\\
Iz zapisa Bezierjeve krivulje z Bernsteinovimi polinomi takoj sledi, da Bezierjeva krivulja interpolira začetno in zadnjo točko. V našem primeru zlepka $s$ to pomeni, da za začetno in končno kontrolno točko na vsaki Bezierjevi krivulji vzamemo kar interpolacijski točki. Natančneje: $b_{j0} = p_j$ in $b_{j3} = p_{j+1}$. To zagotavlja interpolacijo in $C^0$ zveznost zlepka $s$.
Naslednji korak je zagotovitev $C^1$ zveznosti. Kratek račun z uporabo zapisa za odvode iz \ref{odvodi} nam da pogoje $C^1$ zveznost interpolacijske Bezierjeve krivulje $s_j$ na kontrolnih točkah $b_{3j}, \ldots b_{3j+3}$:
\[\begin{align}
\label{tocke}
b_{3j+1} &= p_j + \frac{1}{3} \cdot \Delta{u_j} v_j, \quad j = 0, 1, \ldots, N-1, \\
b_{3j-1} &= p_j - \frac{1}{3} \Delta{u_{j-1}} v_j, \quad j = 1, 2, \ldots, N.
\end{align}\]
V našem primeru lahko potem z upoštevanje $C^0$ in $C^1$, vsako Bezierjevo krivuljo $s_j, j=0, \ldots N-1$ v lokalnem parametru $t_j$ zapišemo kot:
\begin{equation}
    \label{c1_zlepek}
    s_j(t_j) = p_j \cdot B_0^3(t_j) +(p_j+\frac{1}{3}v_j\Delta{u_j})\cdot B_1^3(t_j) +(p_{j+1}-\frac{1}{3}v_{j+1}\Delta{u_j})\cdot B_2^2(t_j)+p_{j+1}\cdot B_3^3(t_j)\text{.}
\end{equation}

\begin{opomba}
    Do zdaj so tangentni vektorji $v_i$ splošni oziroma nedoločeni. Izjema sta začetni in končni tangetni vektor, ki sta podana. Preostale vektorje določimo z zahtevo po $C^2$ zveznosti krivulje/zlepka $s$. 
\end{opomba}
\begin{opomba}
    V \ref{tocke} smo videli, da bomo poznali vse kontrolne točke, brž ko poznamo vse tangentne vektorje.
\end{opomba}

Določimo tangentne vektorje $v_i, i=1, \ldots v_{N-1}$ tako, da bo zlepek $C^2$. Za vsak $j=1, 2, \ldots, N-1$ mora veljati:\[
\frac{d^2s}{du^2}(u_j-0)=\frac{d^2s}{{du}^2}(u_j+0)\text{.}
\]

Zapišimo levi odvod:
\begin{equation}
    \frac{d^2}{du^2}s(u_j-0) = \frac{d^2}{du^2}s_{j-1}(u_j)=
    (\frac{dt}{du})^2\cdot \frac{d^2{s_{j-1}}}{dt_{j-1}^2}(1)=
    \frac{1}{(\Delta{u_{j-1}})^2}\cdot \frac{d^2{s_{j-1}}}{dt_{j-1}^2}(1)\text{.}
\end{equation}
Sedaj uporabimo zapis \ref{c1_zlepek} za $s_{j-1}$ in izražavo drugih odvodov kot v \ref{odvodi} da dobimo:
\begin{align}
    \frac{d^2}{du^2}s(u_j-0) &= \frac{6}{(\Delta{u_{j-1}})^2} \cdot ((p_{j-1} + \frac{1}{3}v_{j-1}\Delta{u_{j-1}}) - 2 \cdot (p_j - \frac{1}{3}v_j\Delta{u_{j-1}}) + p_j) \\
    &= \frac{6}{(\Delta{u_{j-1}})^2} \cdot (\frac{1}{3}v_{j-1}\Delta{u_{j-1}} + \frac{2}{3}v_j\Delta{u_{j-1}} - \Delta{p_{j-1}})
\end{align}
Pri tem smo vpeljali novo oznako za razliko dveh zaporednih interpolacijskih točk $\Delta{p_{j}} = p_{j+1} - p_{j}$.\\
Na podoben način dobimo tudi drugi desni odvod v delilni točki $u_j$:
\[
\frac{d^2}{du^2}s(u_j+0) = \frac{6}{(\Delta{u_{j}})^2}\cdot 
(\Delta{p_j} - \frac{2}{3}v_j\Delta{u_j}-\frac{1}{3}v_{j+1}\Delta{u_j})\text{.}
\]
Sedaj desni in levi drugi odvod enačimo in po kratkem računu dobimo, da mora za tangentne vektorje $v_j, j=1, \ldots, N-1$ veljati:
\[
v_{j-1} \cdot \frac{\Delta{u_j}}{\Delta{u_j} + \Delta{u_{j-1}}} +
2v_j + v_{j+1} \cdot \frac{\Delta{u_{j-1}}}{\Delta{u_j} + \Delta{u_{j-1}}} &= \frac{3}{\Delta{u_j} + \Delta{u_{j-1}}}(
\frac{\Delta{p_j}\Delta{u_{j-1}}}{\Delta{u_j}} + \frac{\Delta{p_{j-1}}\Delta{u_{j}}}{\Delta{u_{j-1}}})
\]
To je sistem $N-1$ linearnih enačb za vektorje $v_j$.
V osnovnem primeru smo predpostavili, da imamo podana $v_0$ in $v_N$, kar sedaj upoštevamo in zapišemo sistem v matrični obliki $AV=B$.
Pri tem je $A$ tridiagonalna matrika z $N-1$ dvojkami na diagonali, vektorjem a=$[\frac{\Delta{u_j}}{\Delta{u_j} + \Delta{u_{j-1}}}], j=2, \ldots, N-1$ na poddiagonali in vektorjem $c = [\frac{\Delta{u_{j-1}}}{\Delta{u_j} + \Delta{u_{j-1}}}], j=1, \ldots, N-2$ na naddiagonali;
V je matrika, ki jo po vrsticah zapišemo kot $[v_{ix} v_{iy}], i=1, \ldots, N-1$ in B' vektor $[\frac{3}{\Delta{u_j} + \Delta{u_{j-1}}}(
\frac{\Delta{p_j}\Delta{u_{j-1}}}{\Delta{u_j}} + \frac{\Delta{p_{j-1}}\Delta{u_{j}}}{\Delta{u_{j-1}}})], j=1, \ldots, N-1$. Vektor B dobimo tako, da popravimo prvo in zadnjo vrstico vektorja B' z upoštevanjem poznanih $v_0$ in $v_N$. Z matlab sintakso bo potem $B(1, 1:2) = \frac{3}{\Delta{u_1} + \Delta{u_{0}}}(\frac{\Delta{p_1}\Delta{u_{0}}}{\Delta{u_1}} + \frac{\Delta{p_0}\Delta{u_{1}}}{\Delta{u_0}}) - v_0\frac{\Delta{u_1}}{\Delta{u_1} + \Delta{u_0}}$. Podobno popravimo $B(N-1, 1:2) = B'(N-1, 1:2) - v_N\frac{\Delta{u_{N-2}}}{\Delta{u_{N-1}} + \Delta{u_{N-2}}}$.
\\
Tak sistem bi lahko rešili recimo z LU-razcepom, kar pa lahko zaradi tridiagonalnosti sistema izboljšamo s Thomasovim algoritmom. To ni nič drugega kot Gaussova eliminacija prilagojena za tridiagonalne sisteme in deluje v linearnem času. Nato uporabimo še obratno substitucijo. Matrika $A$ bo strogo diagonalno dominantna in zato obrnljiva, kar je znano dejstvo, katerega dokaz spuščamo. Posledično bo rešitev ena sama in jo bo Thomasov algoritem tudi našel.

A je res strogo diagonalno dominantna, saj je \\$\frac{\Delta{u_j}}{\Delta{u_j} + \Delta{u_{j-1}}} + \frac{\Delta{u_{j-1}}}{\Delta{u_j} + \Delta{u_{j+-1}}} = 1 < 2$, $\frac{\Delta{u_2}}{\Delta{u_2} + \Delta{u_1}} < 1<2$ in $\frac{\Delta{u_{N-1}}}{\Delta{u_{N-2}} + \Delta{u_{N-1}}} < 1<2$.\\
Od tod dobimo tangentne vektorje v notranjih delilnih točkah, s čimer so posledično določene vse kontrolne točke, če za Bezierjevo krivuljo $s_j$ na kontrolnih točkah $p_j, b_{3j+1}, b_{3(j+1)-1}, p_{j+1}$ uporabimo:
\[\begin{align}
\label{tocke}
b_{3j+1} &= p_j + \frac{1}{3} \cdot \Delta{u_j} v_j, \quad j = 0, 1, \ldots, N-1, \\
b_{3j-1} &= p_j - \frac{1}{3} \Delta{u_{j-1}} v_j, \quad j = 1, 2, \ldots, N.
\end{align}\]
S tem je konstrukcija zlepka končana.

\subsubsection{Besselov zlepek}
Poglejmo si še primer konstrukcije zlepka, ko tangentna vektorja $v_0$ in $v_N$ nista podana. Sistemu iz osnovnega primera dodamo enačbi:
$v_0 = \frac{2}{\Delta{u_0}}\Delta{p_0} - v_1$ in $v_N=\frac{2}{\Delta{u_{N-1}}} \Delta{p_{N-1}}-v_{N-1}$.
Dobimo sistem $A_2V_2=B_2$.
Pri tem je $A_2(2:N-1, 2:N-1) = A$, kjer je $A$ matrika iz osnovnega primera, $A_2(1,:) = [1, 1, 0, \ldots, 0]$, $A_2(N+1, :) = [0, 0, \ldots, 0, 1, 1]$,  
$A_2(2:1) = \frac{\Delta{u_1}}{\Delta{u_1} + \Delta{u_0}}$ in $A_2(N+1, N) =  \frac{\Delta{u_{N-1}}}{\Delta{u_{N-1}} + \Delta{u_{N-2}}}$.
Matrika tangentnih vektorjev je tokrat $V \in \R^{(N+1)\times{2}}$.
Vektor $B_2$ je tudi $N+1$ dimenzionalen in velja $B_2(2:N)=B'$, $B(1)=\frac{2\Delta{p_0}}{\Delta{u_0}}$, $B(N+1)=\frac{2\Delta{p_{N-1}}}{\Delta{u_{N-1}}}$, kar smo dobili iz dodatnih 2 enačb za $v_0$ in $v_N$.
Matrika $A_2$ je prav tako strogo diagonalno dominantna, zato zdaj lahko nadaljujemo s Thomasovim algoritmom kot v osnovnem primeru. Tudi tu dobimo rešitev v linearnem času.

\subsubsection{Izbira delilnih točk}
Kot je razvidno iz do zdaj povedanega, je oblika zlepka odvisna tudi od izbire delilnih točk. Do zdaj smo imeli delilne točke podane. V praksi pogosto to ni res in ni jasno kakšna izbira delilnih točk je optimalna, saj pojem optimalnosti niti ni dobro definiran, ampak je lahko subjektiven glede na potrebe oblikovalca. 

\begin{definicija}
    Delilne točke lahko izberemo na sledeč način:\\
    $u_0=0, u_i=u_{i-1}+||p_i-p_{i-1}||_2^{\alpha}, \quad i=1, \ldots, N$, $\quad \alpha \in [0, 1]$.\\
    Temu pravimo, da smo izbrali $\alpha$-parametrizacijo.
\end{definicija}
Za nekatere vrednosti $\alpha$ dobimo parametrizacijo, ki je dovolj pomembna, da si zasluži svoje ime.
\begin{itemize}
    \item Pri $\alpha = 0$ imamo ekvidistančne točke, čemur pravimo \emph{enakomerna parametrizacija},
    \item \emph{centripetalna parametrizacija} je pri $\alpha = \frac{1}{2}$,
    \item \emph{tetivna parametrizacija} je pri $\alpha = 1$.
\end{itemize}

\section{Primeri}

\begin{figure}[htbp]
  \centering
  \begin{minipage}{0.45\textwidth}
    \centering
    \includegraphics[scale=0.7]{podana.eps}
  \end{minipage}\hfill
  \begin{minipage}{0.45\textwidth}
    \centering
    \includegraphics[scale=0.58]{bessel.eps}
  \end{minipage}
\end{figure}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{siam}
\bibliographystyle{magic}

\begin{thebibliography}{1}
    \bibitem{CAGD}
    G. Farin: Curves and surfaces for CAGD, A Practical Guide, 5th ed., Morgan Kaufmann, 2002,
    \bibitem{Žagar}
    Emil Žagar: Interpolacija s parametričnimi polinomskimi krivuljami, 2009.
\end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}
